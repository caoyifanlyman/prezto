
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Preferred editor for local and remote sessions
export EDITOR='vim'

# Customize to your needs...
export PATH=$PATH:"/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin/g4bin:/usr/games"
export PATH=$PATH:$HOME/bin
export PATH="$HOME/.linuxbrew/bin:$HOME/bin:$PATH"

# System variables
export SUBLIME=subl
export VISUAL=$EDITOR
LS_COLORS=$LS_COLORS:'di=0;33:' ; export LS_COLORS

# Set the terminal title
case $TERM in
    xterm*)
        precmd () {print -Pn "\e]0;%~\a"}
        ;;
esac

######################
### START OF ALIAS ###
######################
# Push and pop directories on directory stack
alias pu='pushd'
alias po='popd'

# Basic directory operations
alias ...='cd ../..'
alias -- -='cd -'

# Super user
alias _='sudo'
alias please='sudo'

#alias g='grep -in'

# Show history
export HIST_STAMPS="yyyy-mm-dd"
if [ "$HIST_STAMPS" = "mm/dd/yyyy" ]
then
    alias history='fc -fl 1'
elif [ "$HIST_STAMPS" = "dd.mm.yyyy" ]
then
    alias history='fc -El 1'
elif [ "$HIST_STAMPS" = "yyyy-mm-dd" ]
then
    alias history='fc -il 1'
else
    alias history='fc -l 1'
fi

HISTFILE=$HOME/.zsh_history

# List direcory contents
alias lsa='ls -lah'
alias l='ls -lah'
alias ll='ls -lh'
alias la='ls -lAh'

# Git
alias g='git'

# Others
alias afind='ack-grep -il'
alias df='df -H'
alias play=mplayer
alias o=xdg-open
alias rm="rm -i"
alias top="top -o %MEM"
alias free="free -gh"
alias h='history | grep -i'
####### END OF ALIAS ######

# Set clobber to overwrite files
setopt clobber

# Run fortune
fortune

#########################################
## Below are the config for corp usage ##
#########################################

# Golang and Java
export PATH="/usr/lib/google-golang/bin:/usr/local/buildtools/java/jdk/bin:$PATH"

# Dart
export PATH=/usr/lib/google-dartlang/bin:$PATH

# F1 support
export PATH="/home/build/static/projects/storage/f1/tools:$PATH"

# Placer
export PATH="/google/data/ro/projects/placer:$PATH"

# Devsite
export PATH="/google/data/ro/projects/devsite:$PATH"

# for the g4d autocomplete
source /etc/bash_completion.d/g4d

# optimizing shell prompt for CITC
CITC_ROOT=/google/src/cloud/${USER}/
SRCFS_HEAD_ROOT=/google/src/head/depot/
pretty_dir_in_pvar() {
  local path_prompt=$(print -P '%~')
  local subst=${path_prompt/#${CITC_ROOT}/citc:}
  subst=${path_prompt/#${SRCFS_HEAD_ROOT}/srcfs-head:}
  psvar[2]=${subst}
}

chpwd_functions+=pretty_dir_in_pvar

# for the g4d autocomplete
source /etc/bash_completion.d/g4d

# Meld for diff
if [ -n "$DISPLAY" ] ; then export G4MULTIDIFF=1 ; fi
#export P4DIFF=vimdiff
export P4DIFF='zsh -c "meld \${@/#:/--diff}" padding-to-occupy-argv0'
export P4MERGE='zsh -c "chmod u+w \$1 ; meld \$2 \$1 \$3 ; cp \$1 \$4" padding-to-occupy-argv0'

# blaze autocomplete
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache

# Automatic prodaccess
if ! prodcertstatus -q; then
  echo "Prodaccess required for this script. Running prodaccess..."
  prodaccess -g
fi

# alias for global test
alias global_green="/google/data/ro/teams/figo/gt_util.par print_last_green"

# alias corp
alias prod='prodaccess -g'
alias fixeclipse='rm /usr/local/google/users/yifanc/eclipse/workspaces/.metadata/.lock'
alias f1-sql='/home/build/static/projects/storage/f1/tools/f1-sql --server=/f1/ads/prod'
alias f1-sql-ext='/home/build/static/projects/storage/f1/tools/f1-sql -server=/f1/ads-ext/prod'
alias shasta-shell='/google/data/ro/projects/ads/shasta/shasta_shell.par'
alias smartsync='/home/build/nonconf/google3/tools/continuous_build/smartsync_for_tap.sh'
alias logreport='/google/data/ro/projects/logs/accesstools/report'
alias cdd='/google/data/ro/projects/chubby/cdd/cdd'

# alias cloud
alias apido=/google/data/ro/teams/oneplatform/apido
alias opgcloud=/google/data/ro/teams/oneplatform/opgcloud
alias gcloud=/google/data/ro/teams/cloud-sdk/gcloud

# alias for corp bigtable
alias borgquota=/google/data/ro/projects/roma/live/contracts_cli/borgquota.par
alias bt_contract=/google/data/ro/projects/roma/live/contracts_cli/bt_contract.par
alias bt_servers_contract=/google/data/ro/projects/roma/live/contracts_cli/bt_servers_contract.par
alias bt_storage_contract=/google/data/ro/projects/roma/live/contracts_cli/bt_storage_contract.par
alias bt_taxation=/google/data/ro/projects/bt-sre/bt_taxation.par
alias bt_translation=/google/data/ro/projects/bt-sre/bt_translation.par
alias storage_contract=/google/data/ro/projects/roma/live/contracts_cli/storage_contract.par
alias contracts_cli=/google/data/ro/projects/roma/live/contracts_cli/contracts_cli.par

# alias for Zanzibar
alias zan=/google/data/ro/teams/acl-zanzibar/tools/zan

# alias for gaia
alias gaiaclient=/google/data/ro/projects/gaia/gaiaclient/GaiaClient
alias gaiatest="/google/data/ro/projects/gaia/gaiaclient/GaiaClient LookupUserByEmail --gaia_instance test"
alias gaiaprod="/google/data/ro/projects/gaia/gaiaclient/GaiaClient LookupUserByEmail --gaia_instance prod"

# alias for cider
alias cider='/google/src/head/depot/google3/experimental/users/edupereda/scripts/cider/cider_here.sh'

# Always use git5 merge!
git() { if [[ $1 == 'merge' ]]; then echo 'Use git5 merge, not git merge. git merge does not understand how to merge the READONLY link and it can corrupt your branch, so stay away from it.  type "unset -f git" to remove this warning'; else command git "$@"; fi; }
